minimum_pre_commit_version: "3.2.0"

repos:
  # Beads issue tracker sync
  - repo: local
    hooks:
      - id: beads-sync
        name: beads sync
        entry: bd hooks run pre-commit
        language: system
        pass_filenames: false
        always_run: true

  # golangci-lint (local hooks to support git worktrees)
  # Uses --new to only lint staged/changed files, enabling atomic commits
  - repo: local
    hooks:
      - id: golangci-lint
        name: golangci-lint
        entry: sh -c 'GOFLAGS=-buildvcs=false golangci-lint run --new --timeout=5m'
        language: system
        types: [go]
        pass_filenames: false
      - id: golangci-lint-fmt
        name: golangci-lint fmt
        entry: sh -c 'GOFLAGS=-buildvcs=false golangci-lint fmt'
        language: system
        types: [go]
        pass_filenames: true

  # Go module maintenance
  - repo: https://github.com/dnephin/pre-commit-golang
    rev: v0.5.1
    hooks:
      - id: go-mod-tidy

  # Go build and test
  # Note: go-build must compile the full package (Go requirement), but only
  # runs when Go files are staged. This is fast and catches compile errors early.
  - repo: local
    hooks:
      - id: go-build
        name: go build
        entry: go build -buildvcs=false -o /dev/null ./cmd/aix
        language: system
        pass_filenames: false
        types: [go]
      - id: gen-doc
        name: generate documentation
        entry: go run ./cmd/aix/main.go gen-doc --dir ./aix-docs/content/docs/reference/
        language: system
        pass_filenames: false
        files: \.go$
      - id: hugo-build
        name: hugo build
        entry: sh -c 'cd aix-docs && npm run build'
        language: system
        pass_filenames: false
        files: ^aix-docs/
<<<<<<< HEAD
=======
      - id: lychee
        name: lychee (link checker)
        entry: lychee --config lychee.toml
        language: system
        pass_filenames: true
        types: [markdown]
>>>>>>> 76e3e0e (ci: add lychee link checker and repo integration tests)

  # General file hygiene
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
        args: [--maxkb=500]
      - id: check-case-conflict

  # GitHub Actions linting
  - repo: https://github.com/rhysd/actionlint
    rev: v1.7.9
    hooks:
      - id: actionlint

  # GitHub Actions security scanning
  - repo: https://github.com/woodruffw/zizmor-pre-commit
    rev: v1.18.0
    hooks:
      - id: zizmor
        args: ["--min-severity=medium"]
